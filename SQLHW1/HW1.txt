CONNECT RAY/123456;

SET LINESIZE 180;
SET PAGESIZE 200;


ALTER TABLE RENTAL
ADD
CONSTRAINT RENTAL_CC_TYPE_VALID
CHECK(CC_TYPE IN('CREDIT','DEBIT'))
ENABLE NOVALIDATE;

ALTER TABLE FILM
MODIFY GENRE VARCHAR2(30);

UPDATE FILM
SET GENRE = CONCAT('Classic ',GENRE)
WHERE (GENRE != 'Classic' OR GENRE IS NULL) AND YEAR < 1970;

SELECT CATALOG_NUM||' '||TITLE AS "FILM"
FROM FILM
WHERE GENRE LIKE 'Classic%';

UPDATE FILM 
SET RATING = 'NR'
WHERE RATING IS NULL;

INSERT INTO film VALUES ('85M','DVD', 'Jack Irish TV Series',2016,2,'PG-13',342,'TV Bibliographic');
INSERT INTO film VALUES ('86M','Blu-ray', 'Batman: The Complete Television Series',2018,3,'PG-13',19,'TV Carton');
INSERT INTO film VALUES ('87M','Blu-ray', 'Stellvia Complete TV Series',2018,1,'R',294,'TV Carton');
INSERT INTO film VALUES ('88M','DVD', 'Mad About You - The Complete Series',2018,14,'R',294,'TV DRAMA');

SELECT INVENTORY.FILM_ID||'-'||TITLE AS "FILM",
STORE.STORE_NUM||'-'||STORE_NAME AS "STORE",DATE_IN
FROM INVENTORY,FILM,STORE
WHERE INVENTORY.CATALOG_NUM = FILM.CATALOG_NUM
AND INVENTORY.STORE_NUM = STORE.STORE_NUM
AND YEAR>=2015
AND GENRE = 'Sci-Fi'
ORDER BY STORE,DATE_IN,INVENTORY.FILM_ID;


COLUMN FILM FORMAT A28;
COLUMN STORE FORMAT A20;
COLUMN LOCATION FORMAT A35;
SELECT CATALOG_NUM||'-'||TITLE AS "FILM",
FILM_ID,RATING,DATE_IN,
STORE_NUM||'-'||STORE_NAME AS STORE,
STREET ||' '|| CITY || ',' || STATE AS "LOCATION"
FROM STORE JOIN INVENTORY USING (STORE_NUM)
		   JOIN FILM USING (CATALOG_NUM)
WHERE DATE_IN >= (SYSDATE-40) AND DATE_IN <= SYSDATE
ORDER BY STORE,FILM;

SELECT DISTINCT MEMBER.MEMBER_ID||' '|| FIRST_NAME || ' ' || LAST_NAME AS "MEMBER"
FROM FILM,INVENTORY,RENTED_ITEM,RENTAL,MEMBER
WHERE FILM.CATALOG_NUM = INVENTORY.CATALOG_NUM
AND INVENTORY.FILM_ID = RENTED_ITEM.FILM_ID
AND RENTED_ITEM.RENTAL_NUM = RENTAL.RENTAL_NUM
AND RENTAL.MEMBER_ID = MEMBER.MEMBER_ID
MINUS
SELECT DISTINCT MEMBER.MEMBER_ID||' '|| FIRST_NAME || ' ' || LAST_NAME AS "MEMBER"
FROM FILM,INVENTORY,RENTED_ITEM,RENTAL,MEMBER
WHERE FILM.CATALOG_NUM = INVENTORY.CATALOG_NUM
AND INVENTORY.FILM_ID = RENTED_ITEM.FILM_ID
AND RENTED_ITEM.RENTAL_NUM = RENTAL.RENTAL_NUM
AND RENTAL.MEMBER_ID = MEMBER.MEMBER_ID
AND GENRE NOT IN ('Sci-Fi','TV Sci-Fi');


COLUMN EMPLOYEE_INFO FORMAT A25;
COLUMN WEEK FORMAT A5;
COLUMN MEMBER_INFO FORMAT A25;
COLUMN STORE_INFO FORMAT A25;
COLUMN HOME_LOCATION FORMAT A15;

SELECT EMPLOYEE.EMP_ID||' '||EMPLOYEE.FIRST_NAME||' '||EMPLOYEE.LAST_NAME AS "EMPLOYEE_INFO",
RENT_DATE,TO_CHAR(RENT_DATE,'W') AS "WEEK",
MEMBER.MEMBER_ID||' '||MEMBER.FIRST_NAME || ' ' || MEMBER.LAST_NAME AS "MEMBER_INFO",
STORE.STORE_NUM||''||STORE_NAME AS "STORE_INFO",
MEMBER.CITY||','||MEMBER.STATE AS "HOME_LOCATION"
FROM EMPLOYEE,STORE,MEMBER,RENTAL,SALES_REP
WHERE EMPLOYEE.EMP_ID = SALES_REP.EMP_ID
AND SALES_REP.EMP_ID = RENTAL.EMP_ID
AND STORE.STORE_NUM = MEMBER.STORE_NUM
AND MEMBER.MEMBER_ID = RENTAL.MEMBER_ID
AND TO_CHAR(RENT_DATE,'W')<=2
AND RENT_DATE LIKE '%MAR%'
AND MEMBER.CITY = 'Pittsburgh'
AND MEMBER.STATE = 'PA'
ORDER BY SALES_REP.EMP_ID,MEMBER.MEMBER_ID;

SELECT EMPLOYEE.EMP_ID||' '||EMPLOYEE.FIRST_NAME||' '||EMPLOYEE.LAST_NAME AS "EMPLOYEE_INFO",
RENT_DATE,TO_CHAR(RENT_DATE,'W') AS "WEEK",
MEMBER.MEMBER_ID||' '||MEMBER.FIRST_NAME || ' ' || MEMBER.LAST_NAME AS "MEMBER_INFO",
STORE.STORE_NUM||''||STORE_NAME AS "STORE_INFO",
MEMBER.CITY||','||MEMBER.STATE AS "HOME_LOCATION"
FROM EMPLOYEE,STORE,MEMBER,RENTAL,SALES_REP
WHERE EMPLOYEE.EMP_ID = SALES_REP.EMP_ID
AND SALES_REP.EMP_ID = RENTAL.EMP_ID
AND STORE.STORE_NUM = MEMBER.STORE_NUM
AND MEMBER.MEMBER_ID = RENTAL.MEMBER_ID
AND TO_CHAR(RENT_DATE,'W')<=2
AND RENT_DATE LIKE '%MAR%'
INTERSECT
SELECT EMPLOYEE.EMP_ID||' '||EMPLOYEE.FIRST_NAME||' '||EMPLOYEE.LAST_NAME AS "EMPLOYEE_INFO",
RENT_DATE,TO_CHAR(RENT_DATE,'W') AS "WEEK",
MEMBER.MEMBER_ID||' '||MEMBER.FIRST_NAME || ' ' || MEMBER.LAST_NAME AS "MEMBER_INFO",
STORE.STORE_NUM||''||STORE_NAME AS "STORE_INFO",
MEMBER.CITY||','||MEMBER.STATE AS "HOME_LOCATION"
FROM EMPLOYEE,STORE,MEMBER,RENTAL,SALES_REP
WHERE EMPLOYEE.EMP_ID = SALES_REP.EMP_ID
AND SALES_REP.EMP_ID = RENTAL.EMP_ID
AND STORE.STORE_NUM = MEMBER.STORE_NUM
AND MEMBER.MEMBER_ID = RENTAL.MEMBER_ID
AND MEMBER.CITY = 'Pittsburgh'
AND MEMBER.STATE = 'PA'
ORDER BY EMPLOYEE_INFO,MEMBER_INFO;

COLUMN RETURN_DATE FORMAT A12;

SELECT MEMBER.MEMBER_ID||' '||MEMBER.FIRST_NAME || ' ' || MEMBER.LAST_NAME AS "MEMBER_INFO",
MEMBER.CITY||','||MEMBER.STATE AS "HOME_LOCATION",
TITLE,RENT_DATE,RETURN_DATE
FROM FILM,INVENTORY,RENTED_ITEM,RENTAL,MEMBER
WHERE FILM.CATALOG_NUM = INVENTORY.CATALOG_NUM
AND INVENTORY.FILM_ID = RENTED_ITEM.FILM_ID
AND RENTED_ITEM.RENTAL_NUM = RENTAL.RENTAL_NUM
AND RENTAL.MEMBER_ID = MEMBER.MEMBER_ID
AND (
(MEMBER.CITY = 'Pittsburgh' AND MEMBER.STATE != 'PA')
OR (MEMBER.CITY != 'Pittsburgh' AND MEMBER.STATE = 'PA')
)
ORDER BY MEMBER.LAST_NAME;


